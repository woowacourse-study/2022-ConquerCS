## 경쟁상태란?

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9010f14b-40f7-4e67-b6ff-8ad24a48b859/Untitled.png)

공유 자원에 대해 여러 개의 프로세스가 동시에 접근을 시도할 때 접근의 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태

→ 동시 접근 시 자료의 일관성을 해치는 결과가 나타남

## RaceCondition과 DeadLock의 차이

[스택오버플로우](https://stackoverflow.com/questions/3130079/difference-between-racearound-condition-and-deadlock)

- DeadLock
    - 교착상태는 두 개 이상의 스레드가 서로를 차단하는 경우다.
    - 일반적으로 공유되는 리소스를 얻으려는 스레드와 관련이 있다.
    - 무한정으로 상대가 가진 리소스를 대기하게 되며, 실행되지 않는다.
- Race Condition
    - 서로 다른 명령이 실행되는 순서에 따라 데이터의 일관성을 해치는 결과를 초래하게 된다.
    - 작업이 실행된다.

## **Race Condition이 발생하는 경우**

### **커널 작업을 수행하는 중에 인터럽트 발생**

- 문제점 : 커널모드에서 데이터를 로드하여 작업을 수행하다가 인터럽트가 발생하여 같은 데이터를 조작하는 경우
- 해결법 : 커널모드에서 작업을 수행하는 동안, 인터럽트를 disable 시켜 CPU 제어권을 가져가지 못하도록 한다.

### **프로세스가 'System Call'을 하여 커널 모드로 진입하여 작업을 수행하는 도중 문맥 교환이 발생할 때**

- 문제점 : 프로세스1이 커널모드에서 데이터를 조작하는 도중, 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우 ( 프로세스2가 작업에 반영되지 않음 )
- 해결법 : 프로세스가 커널모드에서 작업을 하는 경우 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가지 않도록 함

### **멀티 프로세서 환경에서 공유 메모리 내의 커널 데이터에 접근할 때**

- 문제점 : 멀티 프로세서 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우
- 해결법 : 커널 내부에 있는 각 공유 데이터에 접근할 때마다, 그 데이터에 대한 lock/unlock을 하는 방법

## Race Condition 해결을 위한 충족 조건 3가지

### Mutual Exclusion (상호 배제)

어떤 프로세스가 임계 영역을 수행 중이면 다른 모든 프로세스들은 그 임계 영역에 들어가지 못하게 막는 것이다.

### Progress(진행)

임계 영역에 들어간 프로세스가 있지 않은 상태에서 임계 영역에 들어가려는 프로세스가 있으면 들어가게 해주어야 한다. 즉, 임계영역에 있는 프로세스 외에는 다른 프로세스가 임계 영역에 진입하는 것을 방해하면 안된다.

### Bounded Waiting(한정 대기)

기아(starvation) 상태를 방지하기 위해 프로세스가 임계 영역에 들어가려고 요청한 후부터 다른 프로세스들이 임계 영역에 들어가는 횟수에 한계가 있어야 한다. 임계 영역에 한 번 들어갔다 나온 프로세스는 다음에 들어갈 떄 제한을 준다.