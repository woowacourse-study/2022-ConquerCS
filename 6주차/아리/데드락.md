# 데드락

## 데드락 ( 교착상태 )

- 두개 이상의 프로세스나 스레드가 서로 자원을 얻지 못해 다음 처리를 하지 못한채로 무한히 대기하는 상태
- 외나무다리에서 서로 비켜주기를 바라는 꼴
- ex) 프로세스1은 자원A를 얻고 자원B를 기다림. 프로세스2는 자원B를 얻고 자원A를 기다림. 서로 원하는 자원이 상대방에게 할당되어있어 무한히 대기중!

## 발생 조건

- 4가지 발생조건이 모두 만족해야만 교착상태라 할 수 있다.
- 상호 배제 (Mutual exclusion)
    - 한 자원에 대해 여러 프로세스가 접근할 수 없다.
- 점유 대기(Hold and wait)
    - 자원을 점유하고있는 상태에서 다른 프로세스가 점유하고있는 자원의 반납을 기다리고있다.
- 비선점(No preemption)
    - 다른 프로세스의 자원을 강제로 선점할 수 없다.
- 순환 대기(Circular wait)
    - 각 프로세스가 순환적으로 다음 프로세스가 원하는 자원을 점유하고있다.

## 해결 방법

- 이 중 단 하나의 방법이라도 이용한다면 교착상태에서 벗어날 수 있다!
- 예방 (Prevention)
    - 4가지의 발생 조건 중 단 하나라도 만족시킬 수 없는 상황을 만든다.
    - 상호 배제 부정 : 여러 프로세스가 자원을 공유할 수 있도록 한다.
    - 점유 대기 부정 : 프로세스가 실행되기 전 모든 자원을 할당받아 대기상황이 일어날 수 없도록 한다.
    - 비선점 부정 : 다른 프로세스의 자원도 선점할 수 있도록 한다.
    - 순환 대기 부정 : 자원에 고유 번호를 할당하여 순서대로 자원을 요구하도록 한다.
    - 단점) 자원 소모가 매우 심하다
- 회피 (Avoidance)
    - 교착상태 발생을 예상하여 안전한 상태에서만 자원 요청을 허용한다. ( 자원할당을 신중하게 하는 것! )
    - safe state : 자원 할당이 가능한 안전한 상태
    - unsafe state : 교착상태 발생 가능성이 있는 안전하지 않은 상태
    - 자원할당 그래프 알고리즘

      : 향후 요청할 수 있는 자원을 간선형태로 표현하는 그래프를 생성하여 cycle이 있다면 자원을 할당하지 않는다.

    - 은행원 알고리즘

      : 프로세스 시작 전 자신이 필요한 각 자원의 최대 개수를 미리 제공하고 safe state인 경우에만 이를 할당한다. unsafe라면 safe해질때까지 대기한다.

- 회복 (Recovery)
    - 교착상태 발생을 막는 것이 아니라, 발생했을 때 이를 해결한다.
    - 탐지 (Detection)
        - 자원할당 그래프를 통해 교착 상태를 탐지한다.
        - 자원을 요청할 때 마다 탐지 알고리즘이 실행되므로 오버헤드가 발생한다.
    - 회복 (Recovery)
        - 교착상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제함으로써 교착상태를 해결한다.

- 무시 (Ignore)
    - 교착상태를 해결하지 않는 것이 해결하는 것 보다 더 적은 성능저하를 발생시킨다면 그냥 무시한다.
